[关于【缓存穿透、缓存击穿、缓存雪崩、热点数据失效】问题的解决方案](https://www.imooc.com/article/283986?from=timeline)

高QPS的系统，每次都去查询数据库，对于你的数据库来说将是灾难


* 什么是缓存穿透

	缓存和数据库都查询不到这条数据，但是请求每次都会打到数据库上面去
	这种查询不存在数据的现象我们称为缓存穿透
	
	解决办法

        1.缓存空值
            之所以会发生穿透，就是因为缓存中没有存储这些空数据的key
            那么我们就可以为这些key对应的值设置为null 丢到缓存里面去。后面再出现查询这个key 的请求的时候，直接返回null 
            但是别忘了设置过期时间
    
        2.BloomFilter[布隆过滤器]
            BloomFilter 类似于一个hbase set 用来判断某个元素（key）是否存在于某个集合中。
            在缓存之前在加一层 BloomFilter ，在查询的时候先去 BloomFilter 去查询 key 是否存在，如果不存在就直接返回，存在再走查缓存 -> 查 DB

* 什么是缓存击穿

	在平常高并发的系统中，大量的请求同时查询一个 key 时，此时这个key正好失效了，就会导致大量的请求都打到数据库上面去。这种现象我们称为缓存击穿
	
	会造成某一时刻数据库请求量过大，压力剧增

	解决办法

        上面的现象是多个线程同时去查询数据库的这条数据，那么我们可以在第一个查询数据的请求上使用一个互斥锁来锁住它。
        
        其他的线程走到这一步拿不到锁就等着，等第一个线程查询到了数据，然后做缓存。后面的线程进来发现已经有缓存了，就直接走缓存。


* 什么是缓存雪崩

	当某一时刻发生大规模的缓存失效的情况，比如你的缓存服务宕机了，会有大量的请求进来直接打到DB上面。结果就是DB 称不住，挂掉
	
	解决办法

		事前：
		使用集群缓存，保证缓存服务的高可用
			如果是使用 Redis，可以使用主从+哨兵 ，Redis Cluster 来避免 Redis 全盘崩溃的情况

		事中：
		ehcache本地缓存 + Hystrix限流&降级,避免MySQL被打死
			1.使用 ehcache 本地缓存的目的也是考虑在 Redis Cluster 完全不可用的时候，ehcache 本地缓存还能够支撑一阵
			2.使用 Hystrix进行限流 & 降级 ，比如一秒来了5000个请求，我们可以设置假设只能有一秒 2000个请求能通过这个组件，
			那么其他剩余的 3000 请求就会走限流逻辑
			3.然后去调用我们自己开发的降级组件（降级），比如设置的一些默认值呀之类的。以此来保护最后的 MySQL 不会被大量的请求给打死
			
		事后：
		开启Redis持久化机制，尽快恢复缓存集群
			一旦重启，就能从磁盘上自动加载数据恢复内存中的数据
		
* 热点数据集中失效

	对于一些热点的数据来说，当缓存失效以后会存在大量的请求过来，然后打到数据库去，从而可能导致数据库崩溃的情况

	解决办法

		设置不同的失效时间
			为了避免这些热点的数据集中失效，那么我们在设置缓存过期时间的时候，我们让他们失效的时间错开。
			比如在一个基础的时间上加上或者减去一个范围内的随机值。
			
		互斥锁
			在第一个请求去查询数据库的时候对他加一个互斥锁，其余的查询请求都会被阻塞住，直到锁被释放，从而保护数据库
			但是也是由于它会阻塞其他的线程，此时系统吞吐量会下降。需要结合实际的业务去考虑是否要这么做。
